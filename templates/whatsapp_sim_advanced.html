<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Encomiendas - WhatsApp</title>
    <style>
        body, html {
            height: 100%;
            margin: 0;
            background-color: #0D1418;
            font-family: Arial, sans-serif;
        }
        .chat-container {
            max-width: 400px;
            height: 100%;
            margin: auto;
            display: flex;
            flex-direction: column;
            background-color: #0D1418;
        }
        .chat-header {
            background-color: #075e54;
            color: white;
            padding: 10px;
            display: flex;
            align-items: center;
        }
        .chat-header img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .chat-body {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
            background-color: #0D1418;
            background-image: url('https://i.pinimg.com/originals/97/c0/07/97c00759d90d786d9b6096d274ad3e07.png');
            background-size: cover;
        }
        .message {
            max-width: 80%;
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 7.5px;
            position: relative;
            color: #000;
            word-wrap: break-word;
        }
        .user-message {
            background-color: #dcf8c6;
            margin-left: auto;
            border-top-right-radius: 0;
        }
        .system-message {
            background-color: white;
            border-top-left-radius: 0;
        }
        .input-area {
            padding: 10px;
            background-color: #1F2C34;
        }
        .input-area form {
            display: flex;
        }
        .input-area input {
            flex-grow: 1;
            border: none;
            border-radius: 20px;
            padding: 10px 15px;
            background-color: #2A3942;
            color: white;
        }
        .input-area button {
            background-color: #00A884;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            margin-left: 10px;
            color: white;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <img src="https://via.placeholder.com/40" alt="Logo">
            <h5 style="margin: 0;">Sistema de Encomiendas</h5>
        </div>
        <div class="chat-body" id="chatBody">
            <!-- Los mensajes se añadirán aquí dinámicamente -->
        </div>
        <div class="input-area">
            <form id="messageForm">
                <input type="text" id="messageInput" placeholder="Escribe un mensaje" autocomplete="off">
                <button type="submit">➤</button>
            </form>
        </div>
    </div>

    <script>
        const chatBody = document.getElementById('chatBody');
        const messageForm = document.getElementById('messageForm');
        const messageInput = document.getElementById('messageInput');
        
        let currentState = 'initial';
        let usuario = null;
        let paquetesDisponibles = [
            { id: 1, descripcion: "Libro", estado: "Listo para recoger" },
            { id: 2, descripcion: "Electrónica", estado: "En camino" },
            { id: 3, descripcion: "Ropa", estado: "Listo para recoger" },
            { id: 4, descripcion: "Artículos de cocina", estado: "Listo para recoger" }
        ];
        let paquetesSeleccionados = [];

        const estados = {
            initial: {
                process: (msg) => {
                    if (msg.toLowerCase() === 'iniciar sesion') {
                        addMessage("Por favor, ingresa tu nombre de usuario:", 'system-message');
                        return 'esperando_usuario';
                    } else {
                        addMessage("Para comenzar, escribe 'iniciar sesion'", 'system-message');
                        return 'initial';
                    }
                }
            },
            esperando_usuario: {
                process: (msg) => {
                    addMessage("Ahora, ingresa tu contraseña:", 'system-message');
                    usuario = { nombre: msg };
                    return 'esperando_password';
                }
            },
            esperando_password: {
                process: (msg) => {
                    if (usuario.nombre === "usuario" && msg === "1234") {
                        addMessage("Inicio de sesión exitoso.", 'system-message');
                        showMainMenu();
                        return 'menu_principal';
                    } else {
                        addMessage("Usuario o contraseña incorrectos. Por favor, escribe 'iniciar sesion' para intentar de nuevo.", 'system-message');
                        usuario = null;
                        return 'initial';
                    }
                }
            },
            menu_principal: {
                process: (msg) => {
                    switch(msg) {
                        case '1': return mostrarPaquetes();
                        case '2': return notificarLlegada();
                        case '3': return mostrarEstadoPaquetes();
                        case '4': return cerrarSesion();
                        case 'menu': 
                            showMainMenu();
                            return 'menu_principal';
                        default:
                            addMessage("Opción no válida. Por favor, elige una opción del menú o escribe 'menu' para ver las opciones.", 'system-message');
                            return 'menu_principal';
                    }
                }
            },
            seleccionando_paquetes: {
                process: (msg) => {
                    if (msg.toLowerCase() === 'todos') {
                        seleccionarTodosPaquetes();
                        return 'confirmando_llegada';
                    } else if (msg.toLowerCase() === 'cancelar') {
                        addMessage("Selección cancelada. Volviendo al menú principal.", 'system-message');
                        showMainMenu();
                        return 'menu_principal';
                    } else {
                        return seleccionarPaquetesEspecificos(msg);
                    }
                }
            },
            confirmando_llegada: {
                process: (msg) => {
                    if (msg.toLowerCase() === 'si') {
                        notificarLlegadaSeleccionados();
                        showMainMenu();
                        return 'menu_principal';
                    } else if (msg.toLowerCase() === 'no') {
                        addMessage("No has notificado tu llegada. Volviendo al menú principal.", 'system-message');
                        showMainMenu();
                        return 'menu_principal';
                    } else {
                        addMessage("Por favor, responde 'Si' para confirmar o 'No' para cancelar.", 'system-message');
                        return 'confirmando_llegada';
                    }
                }
            }
        };

        function addMessage(text, className) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', className);
            messageElement.innerHTML = text.replace(/\n/g, '<br>');
            chatBody.appendChild(messageElement);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        function showMainMenu() {
            const menuText = `Menú Principal:
1. Ver paquetes disponibles
2. Notificar llegada para recoger
3. Ver estado de mis paquetes
4. Cerrar sesión

Por favor, escribe el número de la opción que deseas.`;
            addMessage(menuText, 'system-message');
        }

        function mostrarPaquetes() {
            let mensaje = "Tus paquetes disponibles:\n";
            paquetesDisponibles.forEach(paquete => {
                mensaje += `${paquete.id}. ${paquete.descripcion} (${paquete.estado})\n`;
            });
            mensaje += "\nPara seleccionar paquetes, escribe los números separados por espacios (ej: '1 3').\nPara seleccionar todos, escribe 'todos'.\nPara cancelar, escribe 'cancelar'.";
            addMessage(mensaje, 'system-message');
            return 'seleccionando_paquetes';
        }

        function seleccionarTodosPaquetes() {
            paquetesSeleccionados = paquetesDisponibles.filter(p => p.estado === "Listo para recoger");
            mostrarPaquetesSeleccionados();
        }

        function seleccionarPaquetesEspecificos(seleccion) {
            const numerosSeleccionados = seleccion.split(' ').map(Number);
            paquetesSeleccionados = paquetesDisponibles.filter(paquete => 
                numerosSeleccionados.includes(paquete.id) && paquete.estado === "Listo para recoger"
            );
            
            if (paquetesSeleccionados.length > 0) {
                mostrarPaquetesSeleccionados();
                return 'confirmando_llegada';
            } else {
                addMessage("No has seleccionado paquetes válidos o listos para recoger. Por favor, intenta de nuevo.", 'system-message');
                return 'seleccionando_paquetes';
            }
        }

        function mostrarPaquetesSeleccionados() {
            let mensaje = "Has seleccionado los siguientes paquetes:\n";
            paquetesSeleccionados.forEach(paquete => {
                mensaje += `- ${paquete.descripcion}\n`;
            });
            mensaje += "\n¿Deseas notificar tu llegada para recoger estos paquetes? (Si/No)";
            addMessage(mensaje, 'system-message');
        }

        function notificarLlegada() {
            if (paquetesSeleccionados.length > 0) {
                return notificarLlegadaSeleccionados();
            } else {
                addMessage("No has seleccionado ningún paquete para recoger. Por favor, primero selecciona los paquetes que deseas recoger.", 'system-message');
                return mostrarPaquetes();
            }
        }

        function notificarLlegadaSeleccionados() {
            let mensaje = "Has notificado tu llegada para recoger los siguientes paquetes:\n";
            paquetesSeleccionados.forEach(paquete => {
                mensaje += `- ${paquete.descripcion}\n`;
            });
            mensaje += "\nPor favor, dirígete al área de recogida. ¿Necesitas algo más?";
            addMessage(mensaje, 'system-message');
            paquetesSeleccionados = []; // Reseteamos la selección después de notificar
            return 'menu_principal';
        }

        function mostrarEstadoPaquetes() {
            let estadoMensaje = "Estado de tus paquetes:\n";
            const listos = paquetesDisponibles.filter(p => p.estado === "Listo para recoger").length;
            const enCamino = paquetesDisponibles.filter(p => p.estado === "En camino").length;
            estadoMensaje += `- ${listos} paquete(s) listo(s) para recoger\n`;
            estadoMensaje += `- ${enCamino} paquete(s) en camino\n`;
            estadoMensaje += "\n¿Qué más puedo hacer por ti?";
            addMessage(estadoMensaje, 'system-message');
            return 'menu_principal';
        }

        function cerrarSesion() {
            usuario = null;
            paquetesSeleccionados = [];
            addMessage("Has cerrado sesión. Escribe 'iniciar sesion' cuando desees volver a entrar.", 'system-message');
            return 'initial';
        }

        function processMessage(message) {
            addMessage(message, 'user-message');
            currentState = estados[currentState].process(message);
        }

        messageForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const message = messageInput.value.trim();
            if (message) {
                processMessage(message);
                messageInput.value = '';
            }
        });

        // Iniciar la conversación
        addMessage("Bienvenido al Sistema de Encomiendas. Para comenzar, escribe 'iniciar sesion'", 'system-message');
    </script>
</body>
</html>